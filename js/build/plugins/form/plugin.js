define(["jquery","underscore","backbone","plugins/form/views/field"],function(e,t,n,r){var i=n.View.extend({tagName:"form",errors:[],fieldViews:[],submitter:{},events:{submit:"submitted"},initialize:function(){t.bindAll(this),this.fields=this.options.fields||[],this.valid=this.options.valid||null,this.error=this.options.error||null},render:function(){return this.fieldViews=[],t.each(this.fields,function(n,i){var s={};t.isUndefined(n.el)?(n.type==="textarea"?n.tagName="textarea":n.tagName="input",n.attributes={name:n.name||"field-"+(i+1),type:n.type||"input",placeholder:n.placeholder||"",value:n.value||"",rel:n.rel||""},s=new r(n),e(this.el).append(s.el),s.addLabel(),this.fieldViews.push(s),n.type==="submit"&&(this.submitter=s)):(s=new r(n),this.fieldViews.push(s),e(s.$el).attr("type")==="submit"&&(this.submitter=s))},this),this},serialized:function(t){return t?e(this.el).serializeObject():e(this.el).serialize()},submitted:function(e){return this.disableSubmit(),this.validate()?this.valid&&this.valid(e):this.error&&this.error(this.errors),!1},validate:function(){return this.errors=[],t.each(this.fieldViews,function(e){t.isEmpty(e.validators)||this.validateField(e)},this),t.isEmpty(this.errors)?!0:!1},validateField:function(e){t.each(e.validators,function(n){t.isFunction(n.custom)?n.custom(e):this["validator"+n.type.charAt(0).toUpperCase()+n.type.slice(1)](e,n)},this)},validatorRegExp:function(t,n){var r=e(t.el).val();r&&(r.match(n.regExp)||this.errors.push({field:t.$el,validator:"RegExp",message:"Not valid"}))},validatorRequired:function(t,n){var r=e(t.el).val();(r===null||r===undefined||r==="")&&this.errors.push({field:t.$el,validator:"Required",message:"Required"})},validatorNumber:function(n,r){var i=Number(e(n.el).val()),s=r.min,o=r.max,u=!1,a="";if(i||i===0)t.isNumber(i)&&!t.isNaN(i)?s&&o?i>=s&&i<=o?u=!0:a="Number must be between "+s+" and "+o:s&&!o?i>=s?u=!0:a="Number be at least "+s:!s&&o?i<=o?u=!0:a="Number be less than "+o:u=!0:a="Value is not a number",u||this.errors.push({field:n.$el,validator:"Number",message:a})},validatorUrl:function(t,n){var r=e(t.el).val();r&&(r.match(/^(http|https):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i)||this.errors.push({field:t.$el,validator:"Url",message:"Invalid Url"}))},validatorEmail:function(t,n){var r=e(t.el).val();r&&(r.match(/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/)||this.errors.push({field:t.$el,validator:"Email",message:"Invalid email address"}))},validatorMatch:function(t,n){var r=e(t.el).val(),i=e("#"+n.field).val();r!==i&&this.errors.push({field:t.$el,validator:"Match",message:'Must match field "'+n.field+'"'})},validatorLength:function(t,n){var r=e(t.el).val(),i=r.length,s=n.min,o=n.max,u=!1,a="";r&&(s&&o?i>=s&&i<=o?u=!0:a="Must be between "+s+" and "+o+" characters":s&&!o?i>=s?u=!0:a="Must be at least "+s+" characters":!s&&o&&(i<=o?u=!0:a="Must be less than "+o+" characters"),u||this.errors.push({field:t.$el,validator:"Length",message:a}))},addInput:function(t){var n={};n.tagName="input",n.added=!0,n.attributes={id:t.id||"field-"+(this.fieldViews.length+1),name:t.name||"field-"+(this.fieldViews.length+1),type:t.type||"input",placeholder:t.placeholder||"",value:t.value||"",rel:t.rel||""};var i=new r(n);e(this.el).append(i.el),this.fieldViews.push(i)},removeInput:function(e){t.each(this.fieldViews,function(t,n){e===t.el&&(t.undelegateEvents(),t.remove(),this.fieldViews.splice(n,1))},this)},disableSubmit:function(){this.submitter.setAttribute("disabled","disabled")},enableSubmit:function(){this.submitter.setAttribute("disabled","")},reset:function(){t.each(this.fieldViews,function(e){e.options.added&&(e.undelegateEvents(),e.remove()),e.reset()}),this.enableSubmit()},destroy:function(){t.each(this.fieldViews,function(e){e.undelegateEvents(),e.remove()}),this.fieldViews=[],this.fields=[],this.undelegateEvents(),this.remove()}});return i});