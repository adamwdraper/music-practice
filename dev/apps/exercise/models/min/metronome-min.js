define(["jQuery","Underscore","Backbone"],function(e,t,n){var r=n.Model.extend({defaults:{tempo:60,tempoMax:200,tempoMin:20,beats:4,currentBeat:1,timeoutTime:{},isOn:!1,timeout:{},taps:[],isMuted:!1,timestamp:(new Date).getTime(),button:"Start",beep:e("#beep")[0],click:e("#click")[0]},initialize:function(){t.bindAll(this);this.set({timeoutTime:Math.round(6e4/this.get("tempo")),currentBeat:this.get("beats")})},toggleState:function(){if(this.get("isOn")){this.stop();this.set({isOn:!1,button:"Start"})}else{this.play();this.set({isOn:!0,button:"Stop"})}},updateTimeoutTime:function(){this.set({timeoutTime:Math.round(6e4/this.get("tempo"))})},play:function(){var e=(new Date).getTime(),t=e-this.get("timestamp");if(t>=this.get("timeoutTime")){console.log(t);this.set("timestamp",e);this.set("timeout",setTimeout(this.play,this.get("timeoutTime")));if(this.get("currentBeat")>=this.get("beats")){this.set("currentBeat",1);this.trigger("firstBeat")}else this.set("currentBeat",this.get("currentBeat")+1);this.get("isMuted")||(this.get("currentBeat")===1&&this.get("beats")>1?this.get("beep").play():this.get("click").play())}else this.timeout=setTimeout(this.play,this.get("timeoutTime")-t)},stop:function(){clearTimeout(this.get("timeout"));this.set("currentBeat",this.get("beats"));this.trigger("stopped")}});return r});